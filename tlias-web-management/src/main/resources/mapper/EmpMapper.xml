<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itheima.tliaswebmanagement.mapper.EmpMapper">
    <!--
        统计员工总数
        @return 员工总记录数
    -->
    <select id="count" resultType="java.lang.Long">
        select count(*) from emp e left join dept d on e.dept_id = d.id
    </select>

    <!--
        分页查询员工列表信息
        @param start 起始记录位置
        @param pageSize 每页显示记录数
        @return 员工信息列表，包含部门名称
    -->
    <select id="list" resultType="com.itheima.tliaswebmanagement.pojo.Emp">
        select e.*, d.name dept_name from emp e left join dept d on e.dept_id = d.id order by update_time desc limit #{start},#{pageSize}
    </select>

    <!--
        分页查询员工信息列表
        @param 无
        @return 员工信息列表，包含员工基本信息和所属部门名称
    -->
    <select id="listPageHelper" resultType="com.itheima.tliaswebmanagement.pojo.Emp">
        <!-- 关联查询员工表和部门表，按更新时间倒序排列 -->
        select e.*, d.name dept_name from emp e left join dept d on e.dept_id = d.id
            <where>
                <if test="name != null and name != ''">
                    and e.name like concat('%', #{name}, '%')
                </if>
                <if test="gender != null">
                    and e.gender = #{gender}
                </if>
                <if test="begin != null">
                    and e.entry_date <![CDATA[>=]]> #{begin}
                </if>
                <if test="end != null">
                    and e.entry_date <![CDATA[<=]]> #{end}
                </if>
            </where>
        order by update_time desc
    </select>

    <!--
        删除员工记录
        @param ids 要删除的员工ID列表
        @return 受影响的记录数
    -->
    <delete id="delete">
        delete from emp where id in
        <!-- 遍历ID集合，构建IN条件语句 -->
        <foreach collection="ids" item="id" open="(" close=")" separator=",">
            #{id}
        </foreach>
    </delete>

    <!--
        插入员工信息
        @param username 用户名
        @param password 密码
        @param name 员工姓名
        @param gender 性别
        @param phone 手机号
        @param job 职位
        @param salary 薪资
        @param image 头像图片路径
        @param entryDate 入职日期
        @param deptId 部门ID
        @param createTime 创建时间
        @param updateTime 更新时间
        @return 生成的主键ID
    -->
    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        insert into emp(username, password, name, gender, phone, job, salary, image, entry_date, dept_id, create_time, update_time)
        values(#{username}, #{password}, #{name}, #{gender}, #{phone}, #{job}, #{salary}, #{image}, #{entryDate}, #{deptId}, #{createTime}, #{updateTime})
    </insert>


    <!--
        根据ID查询员工信息
        @param id 员工ID
        @return Emp 员工对象
    -->
    <select id="selectById" resultType="com.itheima.tliaswebmanagement.pojo.Emp">
        select id, username, password, name, gender, phone, job, salary, image, entry_date, dept_id, create_time, update_time from emp where id = #{id}
    </select>

    <!--
        动态更新员工信息
        @param username 用户名
        @param password 密码
        @param name 员工姓名
        @param gender 性别
        @param phone 电话号码
        @param job 职位
        @param salary 薪资
        @param image 头像图片路径
        @param entryDate 入职日期
        @param deptId 部门ID
        @param updateTime 更新时间
        @param id 员工ID
        @return 受影响的行数
    -->
    <update id="update">
        update emp
        <set>
            <if test="username != null and username != ''">
                username = #{username},
            </if>
            <if test="password != null and password != ''">
                password = #{password},
            </if>
            <if test="name != null and name != ''">
                name = #{name},
            </if>
            <if test="gender != null">
                gender = #{gender},
            </if>
            <if test="phone != null and phone != ''">
                phone = #{phone},
            </if>
            <if test="job != null and job != ''">
                job = #{job},
            </if>
            <if test="salary != null">
                salary = #{salary},
            </if>
            <if test="image != null and image != ''">
                image = #{image},
            </if>
            <if test="entryDate != null">
                entry_date = #{entryDate},
            </if>
            <if test="deptId != null">
                dept_id = #{deptId},
            </if>
            update_time = #{updateTime}
        </set>
        where id = #{id}
    </update>

</mapper>
